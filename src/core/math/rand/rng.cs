// Copyright 2009 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.
namespace go.math;

partial class rand_package {

/*
 * Uniform distribution
 *
 * algorithm by
 * DP Mitchell and JA Reeds
 */
internal static readonly UntypedInt rngLen = 607;
internal static readonly UntypedInt rngTap = 273;
internal static readonly UntypedInt rngMax = /* 1 << 63 */ 9223372036854775808;
internal static readonly UntypedInt rngMask = /* rngMax - 1 */ 9223372036854775807;
internal static readonly UntypedInt int32max = /* (1 << 31) - 1 */ 2147483647;

internal static array<int64> rngCooked = new int64[]{
    -(nint)4181792142133755926L, -(nint)4576982950128230565L, (nint)1395769623340756751L, (nint)5333664234075297259L,
    -(nint)6347679516498800754L, (nint)9033628115061424579L, (nint)7143218595135194537L, (nint)4812947590706362721L,
    (nint)7937252194349799378L, (nint)5307299880338848416L, (nint)8209348851763925077L, -(nint)7107630437535961764L,
    (nint)4593015457530856296L, (nint)8140875735541888011L, -(nint)5903942795589686782L, -(nint)603556388664454774L,
    -(nint)7496297993371156308L, (nint)113108499721038619L, (nint)4569519971459345583L, -(nint)4160538177779461077L,
    -(nint)6835753265595711384L, -(nint)6507240692498089696L, (nint)6559392774825876886L, (nint)7650093201692370310L,
    (nint)7684323884043752161L, -(nint)8965504200858744418L, -(nint)2629915517445760644L, (nint)271327514973697897L,
    -(nint)6433985589514657524L, (nint)1065192797246149621L, (nint)3344507881999356393L, -(nint)4763574095074709175L,
    (nint)7465081662728599889L, (nint)1014950805555097187L, -(nint)4773931307508785033L, -(nint)5742262670416273165L,
    (nint)2418672789110888383L, (nint)5796562887576294778L, (nint)4484266064449540171L, (nint)3738982361971787048L,
    -(nint)4699774852342421385L, (nint)10530508058128498L, -(nint)589538253572429690L, -(nint)6598062107225984180L,
    (nint)8660405965245884302L, (nint)10162832508971942L, -(nint)2682657355892958417L, (nint)7031802312784620857L,
    (nint)6240911277345944669L, (nint)831864355460801054L, -(nint)1218937899312622917L, (nint)2116287251661052151L,
    (nint)2202309800992166967L, (nint)9161020366945053561L, (nint)4069299552407763864L, (nint)4936383537992622449L,
    (nint)457351505131524928L, -(nint)8881176990926596454L, -(nint)6375600354038175299L, -(nint)7155351920868399290L,
    (nint)4368649989588021065L, (nint)887231587095185257L, -(nint)3659780529968199312L, -(nint)2407146836602825512L,
    (nint)5616972787034086048L, -(nint)751562733459939242L, (nint)1686575021641186857L, -(nint)5177887698780513806L,
    -(nint)4979215821652996885L, -(nint)1375154703071198421L, (nint)5632136521049761902L, -(nint)8390088894796940536L,
    -(nint)193645528485698615L, -(nint)5979788902190688516L, -(nint)4907000935050298721L, -(nint)285522056888777828L,
    -(nint)2776431630044341707L, (nint)1679342092332374735L, (nint)6050638460742422078L, -(nint)2229851317345194226L,
    -(nint)1582494184340482199L, (nint)5881353426285907985L, (nint)812786550756860885L, (nint)4541845584483343330L,
    -(nint)6497901820577766722L, (nint)4980675660146853729L, -(nint)4012602956251539747L, -(nint)329088717864244987L,
    -(nint)2896929232104691526L, (nint)1495812843684243920L, -(nint)2153620458055647789L, (nint)7370257291860230865L,
    -(nint)2466442761497833547L, (nint)4706794511633873654L, -(nint)1398851569026877145L, (nint)8549875090542453214L,
    -(nint)9189721207376179652L, -(nint)7894453601103453165L, (nint)7297902601803624459L, (nint)1011190183918857495L,
    -(nint)6985347000036920864L, (nint)5147159997473910359L, -(nint)8326859945294252826L, (nint)2659470849286379941L,
    (nint)6097729358393448602L, -(nint)7491646050550022124L, -(nint)5117116194870963097L, -(nint)896216826133240300L,
    -(nint)745860416168701406L, (nint)5803876044675762232L, -(nint)787954255994554146L, -(nint)3234519180203704564L,
    -(nint)4507534739750823898L, -(nint)1657200065590290694L, (nint)505808562678895611L, -(nint)4153273856159712438L,
    -(nint)8381261370078904295L, (nint)572156825025677802L, (nint)1791881013492340891L, (nint)3393267094866038768L,
    -(nint)5444650186382539299L, (nint)2352769483186201278L, -(nint)7930912453007408350L, -(nint)325464993179687389L,
    -(nint)3441562999710612272L, -(nint)6489413242825283295L, (nint)5092019688680754699L, -(nint)227247482082248967L,
    (nint)4234737173186232084L, (nint)5027558287275472836L, (nint)4635198586344772304L, -(nint)536033143587636457L,
    (nint)5907508150730407386L, -(nint)8438615781380831356L, (nint)972392927514829904L, -(nint)3801314342046600696L,
    -(nint)4064951393885491917L, -(nint)174840358296132583L, (nint)2407211146698877100L, -(nint)1640089820333676239L,
    (nint)3940796514530962282L, -(nint)5882197405809569433L, (nint)3095313889586102949L, -(nint)1818050141166537098L,
    (nint)5832080132947175283L, (nint)7890064875145919662L, (nint)8184139210799583195L, -(nint)8073512175445549678L,
    -(nint)7758774793014564506L, -(nint)4581724029666783935L, (nint)3516491885471466898L, -(nint)8267083515063118116L,
    (nint)6657089965014657519L, (nint)5220884358887979358L, (nint)1796677326474620641L, (nint)5340761970648932916L,
    (nint)1147977171614181568L, (nint)5066037465548252321L, (nint)2574765911837859848L, (nint)1085848279845204775L,
    -(nint)5873264506986385449L, (nint)6116438694366558490L, (nint)2107701075971293812L, -(nint)7420077970933506541L,
    (nint)2469478054175558874L, -(nint)1855128755834809824L, -(nint)5431463669011098282L, -(nint)9038325065738319171L,
    -(nint)6966276280341336160L, (nint)7217693971077460129L, -(nint)8314322083775271549L, (nint)7196649268545224266L,
    -(nint)3585711691453906209L, -(nint)5267827091426810625L, (nint)8057528650917418961L, -(nint)5084103596553648165L,
    -(nint)2601445448341207749L, -(nint)7850010900052094367L, (nint)6527366231383600011L, (nint)3507654575162700890L,
    (nint)9202058512774729859L, (nint)1954818376891585542L, -(nint)2582991129724600103L, (nint)8299563319178235687L,
    -(nint)5321504681635821435L, (nint)7046310742295574065L, -(nint)2376176645520785576L, -(nint)7650733936335907755L,
    (nint)8850422670118399721L, (nint)3631909142291992901L, (nint)5158881091950831288L, -(nint)6340413719511654215L,
    (nint)4763258931815816403L, (nint)6280052734341785344L, -(nint)4979582628649810958L, (nint)2043464728020827976L,
    -(nint)2678071570832690343L, (nint)4562580375758598164L, (nint)5495451168795427352L, -(nint)7485059175264624713L,
    (nint)553004618757816492L, (nint)6895160632757959823L, -(nint)989748114590090637L, (nint)7139506338801360852L,
    -(nint)672480814466784139L, (nint)5535668688139305547L, (nint)2430933853350256242L, -(nint)3821430778991574732L,
    -(nint)1063731997747047009L, -(nint)3065878205254005442L, (nint)7632066283658143750L, (nint)6308328381617103346L,
    (nint)3681878764086140361L, (nint)3289686137190109749L, (nint)6587997200611086848L, (nint)244714774258135476L,
    -(nint)5143583659437639708L, (nint)8090302575944624335L, (nint)2945117363431356361L, -(nint)8359047641006034763L,
    (nint)3009039260312620700L, -(nint)793344576772241777L, (nint)401084700045993341L, -(nint)1968749590416080887L,
    (nint)4707864159563588614L, -(nint)3583123505891281857L, -(nint)3240864324164777915L, -(nint)5908273794572565703L,
    -(nint)3719524458082857382L, -(nint)5281400669679581926L, (nint)8118566580304798074L, (nint)3839261274019871296L,
    (nint)7062410411742090847L, -(nint)8481991033874568140L, (nint)6027994129690250817L, -(nint)6725542042704711878L,
    -(nint)2971981702428546974L, -(nint)7854441788951256975L, (nint)8809096399316380241L, (nint)6492004350391900708L,
    (nint)2462145737463489636L, -(nint)8818543617934476634L, -(nint)5070345602623085213L, -(nint)8961586321599299868L,
    -(nint)3758656652254704451L, -(nint)8630661632476012791L, (nint)6764129236657751224L, -(nint)709716318315418359L,
    -(nint)3403028373052861600L, -(nint)8838073512170985897L, -(nint)3999237033416576341L, -(nint)2920240395515973663L,
    -(nint)2073249475545404416L, (nint)368107899140673753L, -(nint)6108185202296464250L, -(nint)6307735683270494757L,
    (nint)4782583894627718279L, (nint)6718292300699989587L, (nint)8387085186914375220L, (nint)3387513132024756289L,
    (nint)4654329375432538231L, -(nint)292704475491394206L, -(nint)3848998599978456535L, (nint)7623042350483453954L,
    (nint)7725442901813263321L, (nint)9186225467561587250L, -(nint)5132344747257272453L, -(nint)6865740430362196008L,
    (nint)2530936820058611833L, (nint)1636551876240043639L, -(nint)3658707362519810009L, (nint)1452244145334316253L,
    -(nint)7161729655835084979L, -(nint)7943791770359481772L, (nint)9108481583171221009L, -(nint)3200093350120725999L,
    (nint)5007630032676973346L, (nint)2153168792952589781L, (nint)6720334534964750538L, -(nint)3181825545719981703L,
    (nint)3433922409283786309L, (nint)2285479922797300912L, (nint)3110614940896576130L, -(nint)2856812446131932915L,
    -(nint)3804580617188639299L, (nint)7163298419643543757L, (nint)4891138053923696990L, (nint)580618510277907015L,
    (nint)1684034065251686769L, (nint)4429514767357295841L, -(nint)8893025458299325803L, -(nint)8103734041042601133L,
    (nint)7177515271653460134L, (nint)4589042248470800257L, -(nint)1530083407795771245L, (nint)143607045258444228L,
    (nint)246994305896273627L, -(nint)8356954712051676521L, (nint)6473547110565816071L, (nint)3092379936208876896L,
    (nint)2058427839513754051L, -(nint)4089587328327907870L, (nint)8785882556301281247L, -(nint)3074039370013608197L,
    -(nint)637529855400303673L, (nint)6137678347805511274L, -(nint)7152924852417805802L, (nint)5708223427705576541L,
    -(nint)3223714144396531304L, (nint)4358391411789012426L, (nint)325123008708389849L, (nint)6837621693887290924L,
    (nint)4843721905315627004L, -(nint)3212720814705499393L, -(nint)3825019837890901156L, (nint)4602025990114250980L,
    (nint)1044646352569048800L, (nint)9106614159853161675L, -(nint)8394115921626182539L, -(nint)4304087667751778808L,
    (nint)2681532557646850893L, (nint)3681559472488511871L, -(nint)3915372517896561773L, -(nint)2889241648411946534L,
    -(nint)6564663803938238204L, -(nint)8060058171802589521L, (nint)581945337509520675L, (nint)3648778920718647903L,
    -(nint)4799698790548231394L, -(nint)7602572252857820065L, (nint)220828013409515943L, -(nint)1072987336855386047L,
    (nint)4287360518296753003L, -(nint)4633371852008891965L, (nint)5513660857261085186L, -(nint)2258542936462001533L,
    -(nint)8744380348503999773L, (nint)8746140185685648781L, (nint)228500091334420247L, (nint)1356187007457302238L,
    (nint)3019253992034194581L, (nint)3152601605678500003L, -(nint)8793219284148773595L, (nint)5559581553696971176L,
    (nint)4916432985369275664L, -(nint)8559797105120221417L, -(nint)5802598197927043732L, (nint)2868348622579915573L,
    -(nint)7224052902810357288L, -(nint)5894682518218493085L, (nint)2587672709781371173L, -(nint)7706116723325376475L,
    (nint)3092343956317362483L, -(nint)5561119517847711700L, (nint)972445599196498113L, -(nint)1558506600978816441L,
    (nint)1708913533482282562L, -(nint)2305554874185907314L, -(nint)6005743014309462908L, -(nint)6653329009633068701L,
    -(nint)483583197311151195L, (nint)2488075924621352812L, -(nint)4529369641467339140L, -(nint)4663743555056261452L,
    (nint)2997203966153298104L, (nint)1282559373026354493L, (nint)240113143146674385L, (nint)8665713329246516443L,
    (nint)628141331766346752L, -(nint)4651421219668005332L, -(nint)7750560848702540400L, (nint)7596648026010355826L,
    -(nint)3132152619100351065L, (nint)7834161864828164065L, (nint)7103445518877254909L, (nint)4390861237357459201L,
    -(nint)4780718172614204074L, -(nint)319889632007444440L, (nint)622261699494173647L, -(nint)3186110786557562560L,
    -(nint)8718967088789066690L, -(nint)1948156510637662747L, -(nint)8212195255998774408L, -(nint)7028621931231314745L,
    (nint)2623071828615234808L, -(nint)4066058308780939700L, -(nint)5484966924888173764L, -(nint)6683604512778046238L,
    -(nint)6756087640505506466L, (nint)5256026990536851868L, (nint)7841086888628396109L, (nint)6640857538655893162L,
    -(nint)8021284697816458310L, -(nint)7109857044414059830L, -(nint)1689021141511844405L, -(nint)4298087301956291063L,
    -(nint)4077748265377282003L, -(nint)998231156719803476L, (nint)2719520354384050532L, (nint)9132346697815513771L,
    (nint)4332154495710163773L, -(nint)2085582442760428892L, (nint)6994721091344268833L, -(nint)2556143461985726874L,
    -(nint)8567931991128098309L, (nint)59934747298466858L, -(nint)3098398008776739403L, -(nint)265597256199410390L,
    (nint)2332206071942466437L, -(nint)7522315324568406181L, (nint)3154897383618636503L, -(nint)7585605855467168281L,
    -(nint)6762850759087199275L, (nint)197309393502684135L, -(nint)8579694182469508493L, (nint)2543179307861934850L,
    (nint)4350769010207485119L, -(nint)4468719947444108136L, -(nint)7207776534213261296L, -(nint)1224312577878317200L,
    (nint)4287946071480840813L, (nint)8362686366770308971L, (nint)6486469209321732151L, -(nint)5605644191012979782L,
    -(nint)1669018511020473564L, (nint)4450022655153542367L, -(nint)7618176296641240059L, -(nint)3896357471549267421L,
    -(nint)4596796223304447488L, -(nint)6531150016257070659L, -(nint)8982326463137525940L, -(nint)4125325062227681798L,
    -(nint)1306489741394045544L, -(nint)8338554946557245229L, (nint)5329160409530630596L, (nint)7790979528857726136L,
    (nint)4955070238059373407L, -(nint)4304834761432101506L, -(nint)6215295852904371179L, (nint)3007769226071157901L,
    -(nint)6753025801236972788L, (nint)8928702772696731736L, (nint)7856187920214445904L, -(nint)4748497451462800923L,
    (nint)7900176660600710914L, -(nint)7082800908938549136L, -(nint)6797926979589575837L, -(nint)6737316883512927978L,
    (nint)4186670094382025798L, (nint)1883939007446035042L, -(nint)414705992779907823L, (nint)3734134241178479257L,
    (nint)4065968871360089196L, (nint)6953124200385847784L, -(nint)7917685222115876751L, -(nint)7585632937840318161L,
    -(nint)5567246375906782599L, -(nint)5256612402221608788L, (nint)3106378204088556331L, -(nint)2894472214076325998L,
    (nint)4565385105440252958L, (nint)1979884289539493806L, -(nint)6891578849933910383L, (nint)3783206694208922581L,
    (nint)8464961209802336085L, (nint)2843963751609577687L, (nint)3030678195484896323L, -(nint)4429654462759003204L,
    (nint)4459239494808162889L, (nint)402587895800087237L, (nint)8057891408711167515L, (nint)4541888170938985079L,
    (nint)1042662272908816815L, -(nint)3666068979732206850L, (nint)2647678726283249984L, (nint)2144477441549833761L,
    -(nint)3417019821499388721L, -(nint)2105601033380872185L, (nint)5916597177708541638L, -(nint)8760774321402454447L,
    (nint)8833658097025758785L, (nint)5970273481425315300L, (nint)563813119381731307L, -(nint)6455022486202078793L,
    (nint)1598828206250873866L, -(nint)4016978389451217698L, -(nint)2988328551145513985L, -(nint)6071154634840136312L,
    (nint)8469693267274066490L, (nint)125672920241807416L, -(nint)3912292412830714870L, -(nint)2559617104544284221L,
    -(nint)486523741806024092L, -(nint)4735332261862713930L, (nint)5923302823487327109L, -(nint)9082480245771672572L,
    -(nint)1808429243461201518L, (nint)7990420780896957397L, (nint)4317817392807076702L, (nint)3625184369705367340L,
    -(nint)6482649271566653105L, -(nint)3480272027152017464L, -(nint)3225473396345736649L, -(nint)368878695502291645L,
    -(nint)3981164001421868007L, -(nint)8522033136963788610L, (nint)7609280429197514109L, (nint)3020985755112334161L,
    -(nint)2572049329799262942L, (nint)2635195723621160615L, (nint)5144520864246028816L, -(nint)8188285521126945980L,
    (nint)1567242097116389047L, (nint)8172389260191636581L, -(nint)2885551685425483535L, -(nint)7060359469858316883L,
    -(nint)6480181133964513127L, -(nint)7317004403633452381L, (nint)6011544915663598137L, (nint)5932255307352610768L,
    (nint)2241128460406315459L, -(nint)8327867140638080220L, (nint)3094483003111372717L, (nint)4583857460292963101L,
    (nint)9079887171656594975L, -(nint)384082854924064405L, -(nint)3460631649611717935L, (nint)4225072055348026230L,
    -(nint)7385151438465742745L, (nint)3801620336801580414L, -(nint)399845416774701952L, -(nint)7446754431269675473L,
    (nint)7899055018877642622L, (nint)5421679761463003041L, (nint)5521102963086275121L, -(nint)4975092593295409910L,
    (nint)8735487530905098534L, -(nint)7462844945281082830L, -(nint)2080886987197029914L, -(nint)1000715163927557685L,
    -(nint)4253840471931071485L, -(nint)5828896094657903328L, (nint)6424174453260338141L, (nint)359248545074932887L,
    -(nint)5949720754023045210L, -(nint)2426265837057637212L, (nint)3030918217665093212L, -(nint)9077771202237461772L,
    -(nint)3186796180789149575L, (nint)740416251634527158L, -(nint)2142944401404840226L, (nint)6951781370868335478L,
    (nint)399922722363687927L, -(nint)8928469722407522623L, -(nint)1378421100515597285L, -(nint)8343051178220066766L,
    -(nint)3030716356046100229L, -(nint)8811767350470065420L, (nint)9026808440365124461L, (nint)6440783557497587732L,
    (nint)4615674634722404292L, (nint)539897290441580544L, (nint)2096238225866883852L, (nint)8751955639408182687L,
    -(nint)7316147128802486205L, (nint)7381039757301768559L, (nint)6157238513393239656L, -(nint)1473377804940618233L,
    (nint)8629571604380892756L, (nint)5280433031239081479L, (nint)7101611890139813254L, (nint)2479018537985767835L,
    (nint)7169176924412769570L, -(nint)1281305539061572506L, -(nint)7865612307799218120L, (nint)2278447439451174845L,
    (nint)3625338785743880657L, (nint)6477479539006708521L, (nint)8976185375579272206L, -(nint)3712000482142939688L,
    (nint)1326024180520890843L, (nint)7537449876596048829L, (nint)5464680203499696154L, (nint)3189671183162196045L,
    (nint)6346751753565857109L, -(nint)8982212049534145501L, -(nint)6127578587196093755L, -(nint)245039190118465649L,
    -(nint)6320577374581628592L, (nint)7208698530190629697L, (nint)7276901792339343736L, -(nint)7490986807540332668L,
    (nint)4133292154170828382L, (nint)2918308698224194548L, -(nint)7703910638917631350L, -(nint)3929437324238184044L,
    -(nint)4300543082831323144L, -(nint)6344160503358350167L, (nint)5896236396443472108L, -(nint)758328221503023383L,
    -(nint)1894351639983151068L, -(nint)307900319840287220L, -(nint)6278469401177312761L, -(nint)2171292963361310674L,
    (nint)8382142935188824023L, (nint)9103922860780351547L, (nint)4152330101494654406L
}.array();

[GoType] partial struct rngSource {
    internal nint tap;          // index into vec
    internal nint feed;          // index into vec
    internal array<int64> vec = new(rngLen); // current feedback register
}

// seed rng x[n+1] = 48271 * x[n] mod (2**31 - 1)
internal static int32 seedrand(int32 x) {
    static readonly UntypedInt A = 48271;
    static readonly UntypedInt Q = 44488;
    static readonly UntypedInt R = 3399;
    var hi = x / Q;
    var lo = x % Q;
    x = A * lo - R * hi;
    if (x < 0) {
        x += int32max;
    }
    return x;
}

// Seed uses the provided seed value to initialize the generator to a deterministic state.
[GoRecv] internal static void Seed(this ref rngSource rng, int64 seed) {
    rng.tap = 0;
    rng.feed = rngLen - rngTap;
    seed = seed % int32max;
    if (seed < 0) {
        seed += int32max;
    }
    if (seed == 0) {
        seed = 89482311;
    }
    var x = ((int32)seed);
    for (nint i = -20; i < rngLen; i++) {
        x = seedrand(x);
        if (i >= 0) {
            int64 u = default!;
            u = ((int64)x) << (int)(40);
            x = seedrand(x);
            u ^= (int64)(((int64)x) << (int)(20));
            x = seedrand(x);
            u ^= (int64)(((int64)x));
            u ^= (int64)(rngCooked[i]);
            rng.vec[i] = u;
        }
    }
}

// Int63 returns a non-negative pseudo-random 63-bit integer as an int64.
[GoRecv] internal static int64 Int63(this ref rngSource rng) {
    return ((int64)((uint64)(rng.Uint64() & rngMask)));
}

// Uint64 returns a non-negative pseudo-random 64-bit integer as a uint64.
[GoRecv] internal static uint64 Uint64(this ref rngSource rng) {
    rng.tap--;
    if (rng.tap < 0) {
        rng.tap += rngLen;
    }
    rng.feed--;
    if (rng.feed < 0) {
        rng.feed += rngLen;
    }
    var x = rng.vec[rng.feed] + rng.vec[rng.tap];
    rng.vec[rng.feed] = x;
    return ((uint64)x);
}

} // end rand_package
